# ===================================================================
# KIWIPAY LOAN API - CONFIGURACIÓN COMPLETA
# ===================================================================

# ===================================================================
# CONFIGURACIÓN DEL SERVIDOR
# ===================================================================
spring.application.name=kiwipay-loan-api
server.port=8081
server.compression.enabled=true
server.compression.mime-types=application/json,application/xml,text/html

# ===================================================================
# SPRING CLOUD COMPATIBILITY
# ===================================================================
spring.cloud.compatibility-verifier.enabled=false

# ===================================================================
# CONFIGURACIÓN DEL BACKEND PRINCIPAL
# ===================================================================
kiwipay.backend.base-url=http://localhost:8080/api/v1
kiwipay.backend.endpoints.create-lead=/leads
kiwipay.backend.endpoints.get-clinics=/clinics
kiwipay.backend.endpoints.get-medical-specialties=/medical-specialties
kiwipay.backend.timeout.connect=30s
kiwipay.backend.timeout.read=60s
kiwipay.backend.retry.max-attempts=3
kiwipay.backend.retry.backoff-delay=1s
kiwipay.backend.retry.max-backoff-delay=10s

# ===================================================================
# CONFIGURACIÓN DE CIRCUIT BREAKER (RESILIENCE4J)
# ===================================================================
resilience4j.circuitbreaker.instances.backend.register-health-indicator=true
resilience4j.circuitbreaker.instances.backend.sliding-window-size=10
resilience4j.circuitbreaker.instances.backend.minimum-number-of-calls=5
resilience4j.circuitbreaker.instances.backend.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.instances.backend.automatic-transition-from-open-state=true
resilience4j.circuitbreaker.instances.backend.wait-duration-in-open-state=5s
resilience4j.circuitbreaker.instances.backend.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.backend.event-consumer-buffer-size=10

# ===================================================================
# CONFIGURACIÓN DE RETRY (RESILIENCE4J)
# ===================================================================
resilience4j.retry.instances.backend.max-retry-attempts=3
resilience4j.retry.instances.backend.wait-duration=1000
resilience4j.retry.instances.backend.retry-exceptions=org.springframework.web.reactive.function.client.WebClientResponseException$ServiceUnavailable,org.springframework.web.reactive.function.client.WebClientResponseException$BadGateway,java.io.IOException,java.util.concurrent.TimeoutException

# ===================================================================
# CONFIGURACIÓN DE CORS
# ===================================================================
cors.allowed-origins=http://localhost:3000,http://localhost:3001,http://localhost:4200,http://localhost:5173
cors.allowed-methods=GET,POST,PUT,DELETE,PATCH,OPTIONS
cors.allowed-headers=*
cors.allow-credentials=true
cors.max-age=3600

# ===================================================================
# CONFIGURACIÓN DE ACTUATOR
# ===================================================================
management.endpoints.web.exposure.include=health,info,metrics,circuitbreakers
management.endpoints.web.base-path=/actuator
management.endpoint.health.show-details=when-authorized
management.health.circuitbreakers.enabled=true

# ===================================================================
# CONFIGURACIÓN DE LOGGING
# ===================================================================
logging.level.com.kiwipay.kiwipay_loan_api=DEBUG
logging.level.org.springframework.web.reactive.function.client=DEBUG
logging.level.io.github.resilience4j=DEBUG
logging.level.org.springdoc=DEBUG
logging.level.org.springframework.web=DEBUG
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# ===================================================================
# CONFIGURACIÓN DE SWAGGER - SOLUCIÓN SIMPLE Y EFECTIVA
# ===================================================================
# Rutas básicas
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.path=/swagger-ui.html

# FORZAR SIN CACHÉ para desarrollo
spring.web.resources.cache.cachecontrol.no-cache=true
spring.web.resources.cache.cachecontrol.no-store=true
spring.web.resources.cache.cachecontrol.must-revalidate=true
spring.web.resources.cache.period=0

# Configuraciones básicas de Swagger
springdoc.swagger-ui.operations-sorter=alpha
springdoc.swagger-ui.tags-sorter=alpha
springdoc.swagger-ui.doc-expansion=none
springdoc.swagger-ui.display-request-duration=true
springdoc.swagger-ui.try-it-out-enabled=true

# CSS PERSONALIZADO INLINE - SOLUCIÓN DIRECTA
springdoc.swagger-ui.custom-css=html body .swagger-ui .opblock .opblock-summary{display:flex !important;flex-direction:row !important;align-items:center !important;min-height:50px !important;max-height:50px !important;padding:10px 15px !important}html body .swagger-ui .opblock .opblock-summary-method{min-width:80px !important;max-width:80px !important;height:30px !important;margin:0 15px 0 0 !important;flex-shrink:0 !important;display:flex !important;align-items:center !important;justify-content:center !important}html body .swagger-ui .opblock .opblock-summary-path{flex:1 1 auto !important;margin:0 15px 0 0 !important;white-space:nowrap !important;overflow:hidden !important;text-overflow:ellipsis !important}html body .swagger-ui .opblock .opblock-summary-description{flex-shrink:0 !important;max-width:250px !important;text-align:right !important}

# Archivo CSS adicional
springdoc.swagger-ui.custom-css-url=/swagger-ui-fix.css

# DESACTIVAR configuraciones que puedan interferir
springdoc.swagger-ui.layout=BaseLayout
springdoc.swagger-ui.deep-linking=true
springdoc.swagger-ui.display-operation-id=false
springdoc.swagger-ui.default-models-expand-depth=1
springdoc.swagger-ui.default-model-expand-depth=1
springdoc.swagger-ui.default-model-rendering=example
springdoc.swagger-ui.filter=false
springdoc.swagger-ui.max-displayed-tags=10
springdoc.swagger-ui.show-extensions=false
springdoc.swagger-ui.show-common-extensions=false

# LIMPIEZA DE CACHÉ AGRESIVA
server.servlet.session.cookie.max-age=0
server.servlet.session.timeout=1m

# ===================================================================
# CONFIGURACIÓN ADICIONAL DE RECURSOS ESTÁTICOS
# ===================================================================
spring.web.resources.static-locations=classpath:/static/,classpath:/META-INF/resources/,classpath:/resources/,classpath:/public/
spring.web.resources.add-mappings=true
